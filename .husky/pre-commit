#!/usr/bin/env sh

# Husky pre-commit hook
# Runs lint, tests, and build before allowing commits
# If any step fails, the commit is blocked

echo "ğŸ” Running pre-commit checks..."
echo ""

# Step 1: Lint (using lint-staged for incremental check)
echo "ğŸ“ Step 1/3: Linting staged files..."
pnpm exec lint-staged
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Lint failed. Please fix the errors above and try again."
  exit 1
fi
echo "âœ… Lint passed!"
echo ""

# Step 2: Type check
echo "ğŸ” Step 2/3: Running type checks..."
pnpm run typecheck
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Type check failed. Please fix the errors above and try again."
  exit 1
fi
echo "âœ… Type check passed!"
echo ""

# Step 3: Tests
echo "ğŸ§ª Step 3/3: Running tests..."
pnpm run test
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Tests failed. Please fix the failing tests and try again."
  exit 1
fi
echo "âœ… Tests passed!"
echo ""

echo "ğŸ‰ All pre-commit checks passed! Proceeding with commit..."
